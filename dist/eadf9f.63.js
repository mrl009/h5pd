webpackJsonp([63],{247:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(127),n=s(o),a=i(363),d=s(a),r=i(364),c=s(r),l=i(4),u=s(l),f=i(68),p=s(f),h=i(2),v=s(h),m=i(24),g=function(){function e($rootScope,$scope,$state,Util,Core,$stateParams,Layer,$timeout,RS){(0,d.default)(this,e),this.$state=$state,this.Util=Util,this.$scope=$scope,this.$rootScope=$rootScope,this.Core=Core,this.L=Layer,this.$timeout=$timeout,this.RS=RS,$scope.data={username:"",pwd:"",p_pwd:"",code:"",codeSrc:"",token_private_key:"",isCode:!1},this.initPage(),this.ret=$stateParams.ret?u.default.fromJson($stateParams.ret):{},$scope.goNext=this.goNext.bind(this),$scope.codeRefresh=this.codeRefresh.bind(this),$scope.login=this.login.bind(this),$scope.seePwd=this.seePwd.bind(this),$scope.wjtip=this.wjtip.bind(this)}return(0,c.default)(e,[{key:"initPage",value:function(){this.Core.getToken()?this.$state.go("tabs.home"):(this.initNeedsCode(),this.getTokenAndCode())}},{key:"goNext",value:function(e){this.$state.go(e)}},{key:"wjtip",value:function(){this.L.toast("请联系在线客服找回密码")}},{key:"initNeedsCode",value:function(){var e=this;this.RS.needCode().then(function(t){200==t.code&&(e.$scope.data.isCode=1==t.data.is_code)})}},{key:"seePwd",value:function(){var e=this;(0,v.default)('input[type="password"]').attr("type","text").addClass("pwd"),this._t||(this._t=this.$timeout(function(){e.$timeout.cancel(e._t),e._t=0,(0,v.default)(".pwd").attr("type","password").removeClass("pwd")},2e3))}},{key:"codeRefresh",value:function(){this.$scope.data.codeSrc=this.$scope.data.codeSrc+"&time="+Math.random()+(new Date).getTime()}},{key:"getTokenAndCode",value:function(){var e=this;this.RS.getToken(!0).then(function(t){200==t.code?(e.$scope.data.token_private_key=t.data.token_private_key||"",e.$scope.data.codeSrc=m.API+"login/code?token_private_key="+t.data.token_private_key):e.L.toast(t.msg,1)})}},{key:"login",value:function(){var e=this,t=this.$scope.data,i=t.username,s=t.pwd,o=void 0===s?null:s,a=t.code,d=t.token_private_key;if(!/^\w{4,20}$/.test(i)||void 0==i)return this.L.toast("用户名为4~14位"),!1;if(this.$scope.data.isCode&&!/^\d{4}$/.test(this.$scope.data.code))return this.L.toast("请输入四位数字验证码"),!1;if(!o)return this.L.toast("请输入密码!"),!1;var r=(0,p.default)(o),c={username:i,pwd:r,code:a,token_private_key:d};this.RS.login(c).then(function(t){if(200==t.code){e.Core.setToken(t.data.token),e.Core.removeCookie("from_register"),e.RS.rLogin().then(function(t){if(200==t.code){e.Core.setToken(t.data.token);var i=(0,n.default)(c,{refresh_time:t.data.refresh_token,expires_time:(new Date).getTime()+parseInt(1e3*t.data.refresh_token),auto_login:(0,p.default)("username="+c.username+"&pwd="+c.pwd)});e.Core.setCookie("loginData",i),e.$rootScope.loginLoop(1e3*i.refresh_time)}});var i=e.ret.url?e.ret.url:"tabs.home",s=e.ret.params?e.ret.params:"";e.L.toast("登陆成功!",1,function(){e.$state.go(i,s)})}else 425==t.code&&(e.$scope.data.isCode=!0),e.L.toast(t.msg),e.getTokenAndCode()})}}]),e}();t.default=g},321:function(e,t){e.exports='<iheader> <back></back> <h1 class=title>登录</h1> </iheader> <content class=login> <form ng-submit=login() name=myForm> <div class=list-block> <ul> <li> <div class=item-content> <div class=item-inner> <div class="item-title label fs16">账号</div> <div class=item-input> <input class=fs16 style=padding:0 placeholder=用户名 ng-model=data.username maxlength=20> </div> </div> </div> </li> <li> <div class=item-content> <div class=item-inner> <div class="item-title label fs16">密码</div> <div class=item-input> <input type=password style=padding:0 placeholder=请输入密码 class=fs16 ng-model=data.pwd> </div> <span class="iconfont icon-eye fs8" ng-click=seePwd()></span> </div> </div> </li> <li ng-if=data.isCode> <div class=item-content> <div class=item-inner> <div class="item-title label fs16">验证码</div> <div class=item-input> <input type=text placeholder=请输入验证码 class=fs16 ng-model=data.code> </div> <img ng-src={{data.codeSrc}} class=code-img ng-click=codeRefresh()> </div> </div> </li> </ul> </div> <button class="button-login fs16" ng-class="{true: \'main-w\', false: \'disabled-bg\'}[!!(data.username && data.pwd)]" type=submit>登录</button> </form> <div class=login-footer-button> <a href=/register class="button-link fs16">快速注册</a> <a ng-click=wjtip() class="button-link fs16 fr">忘记密码</a> </div> </content> '},363:function(e,t,i){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},364:function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=i(365),n=s(o);t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,n.default)(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}()},365:function(e,t,i){e.exports={default:i(366),__esModule:!0}},366:function(e,t,i){i(367);var s=i(11).Object;e.exports=function(e,t,i){return s.defineProperty(e,t,i)}},367:function(e,t,i){var s=i(15);s(s.S+s.F*!i(21),"Object",{defineProperty:i(20).f})}});