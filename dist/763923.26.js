webpackJsonp([26],{235:function(e,n,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=s(426),t=i(o),a=s(363),r=i(a),d=s(364),c=i(d),l=s(68),p=i(l),u=function(){function e($scope,$stateParams,RS,Layer,Core,$state){(0,r.default)(this,e),this.$scope=$scope,this.$RS=RS,this.Layer=Layer,this.Core=Core,this.$state=$state,this.$scope.submit=this.submit.bind(this),this.$scope.showBankList=this.showBankList.bind(this),this.$scope.setBank=this.setBank.bind(this),this.$scope.uploadQRCode=this.uploadQRCode.bind(this),$scope.rules={bank_name:{required:!0,reg:/^[\u4E00-\u9FA5]{2,5}(?:·[\u4E00-\u9FA5]{2,5})*$/,message:"姓名格式不正确!"},bank_num:{required:!0,reg:/^\d{16}|\d{19}$/,message:"卡号格式不正确!"},wx:{required:!0,reg:/^[a-zA-Z\d_]{5,16}$/,message:"微信账号不正确!"},zfb:{required:!0,reg:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+|1[3,5,6,7,8]\d{9}$/,message:"支付宝账号不正确!"},file:{required:!0,reg:/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/,message:"请上传您的支付二维码!"},bank_id:{required:!0,reg:/^\d{1,6}$/,message:"请选择银行!"},address:{required:!0,reg:/^([a-zA-Z\u4e00-\u9fa5]{1,50})$/,message:"银行开户地址不能为空!"},bank_pwd:{required:!0,reg:/^\d{6}$/,message:"密码格式不正确!"},phone:{required:!1,reg:/^1[3,5,7,8]\d{9}$/,message:"电话号码格式不正确!"}},$scope.form={bank_name:"",phone:""},$scope.isPhone=null,$scope.bankList=null,$scope.QR_code=null,$scope.show_bankInfo=!1,$scope.type=$stateParams.type,$scope.title="",$scope.isPwd=!0,this.getBankUsername(),this.getTitle()}return(0,c.default)(e,[{key:"setBank",value:function(e){this.$scope.form.bank_id=e}},{key:"getBankUsername",value:function(){var e=this;this.$RS.getBankName().then(function(n){if(200==n.code){var s=n.data;e.$scope.form.bank_name=s.name,e.$scope.show_name=!s.name,e.$scope.form.phone=s.phone,e.$scope.show_phone=!s.phone,e.$scope.isPwd=s.is_pwd,e.$scope.isPhone=s.is_phone,s.is_phone&&(e.$scope.rules.phone.required=!0)}})}},{key:"getTitle",value:function(){switch(this.$scope.type){case"0":this.$scope.form.bank_id=51,this.$scope.form.zfb="",this.$scope.form.file="",this.$scope.title="绑定支付宝";break;case"1":this.$scope.form.bank_id=52,this.$scope.form.file="",this.$scope.title="绑定微信";break;case"2":this.$scope.form.bank_num="",this.$scope.form.bank_id=0,this.$scope.form.address="",this.$scope.title="绑定银行卡"}this.$scope.form.bank_pwd=""}},{key:"showBankList",value:function(){var e=this;e.$scope.bankList?e.show():e.$RS.getBankList().then(function(n){if(200==n.code){var s=n.data.rows;e.$scope.bankList=e.filterArr(s),e.show()}else e.Layer.toast(n.msg)})}},{key:"uploadQRCode",value:function(e){var n=this,s=e.target.files[0];if(s){if("undefined"==typeof FileReader)return void n.Layer.toast("浏览器版本过低!");if(!/image\/\w+/.test(s.type))return void n.Layer.toast("必须上传图片");if(s.size>1048576)return void n.Layer.toast("图片大小不能超过1M");var i=new FormData;i.append("file",s);var o=n.Layer.loading("图片上传中...");n.$RS.upload(i).then(function(e){200==e.status?(n.$scope.QR_code=e.data.result,n.$scope.form.file=e.data.result,o&&o.close()):n.Layer.toast(e.msg)})}}},{key:"show",value:function(){var e=this,n=this.Layer.popup({tpl:'<div class="show-banks"\n                    ng-repeat="x in bankList track by $index"\n                    ng-click="setBank(x.id)"\n                    ng-if="x"\n                    ng-class="{\'current-bank\': form.bank_id == x.id}">\n                    <div class="row">\n                        <img class="col-center" ng-src="{{x.img}}">\n                        <span class="col-center" bank_id="{{x.id}}" is_qcode="{{x.is_qcode}}">{{x.name}}</span>\n                    </div>\n                </div>',wrap:function(e){return'<div class="popup-form">\n                            <div class="popup-title fs14 main-bg white-text">选择银行</div>\n                            <div class="popup-content clearfix">\n                                '+(e||"")+'\n                            </div>\n                            <div class="popup-btns">\n                                <button class="button button-primary cancel-btn">取消</button>\n                                <button class="button button-primary button-fill">确定</button>\n                            </div>\n                        </div>'},scope:e.$scope});n.find(".modal-content").css({borderRadius:"0.5rem"}),n.find(".popup-content").css({maxHeight:"22rem",overflow:"auto"}),n.find(".popup-title").css({background:"#eee",borderTopLeftRadius:"10px",borderTopRightRadius:"10px"}),n.find(".button-fill").on("click",function(){n.remove()}),n.find(".cancel-btn").on("click",function(){e.setBank(0),n.remove()})}},{key:"filterArr",value:function(e){var n=[],s=!0,i=!1,o=void 0;try{for(var a,r=(0,t.default)(e);!(s=(a=r.next()).done);s=!0){var d=a.value;51!=d.id&&52!=d.id&&(n[d.id]={id:d.id,name:d.bank_name,img:d.img})}}catch(e){i=!0,o=e}finally{try{!s&&r.return&&r.return()}finally{if(i)throw o}}return n}},{key:"submit",value:function(){var e=this;if(51!=this.$scope.form.bank_id&&52!=this.$scope.form.bank_id||(this.$scope.rules.bank_name.required=!1),!e.Core.valiForm(e.$scope.form,e.$scope.rules))return!1;var n={phone:e.$scope.form.phone,bank_name:e.$scope.form.bank_name,bank_pwd:e.$scope.form.bank_pwd&&(0,p.default)(e.$scope.form.bank_pwd),num:e.$scope.form.bank_num||e.$scope.form.wx||e.$scope.form.zfb,bank_id:e.$scope.form.bank_id,address:e.$scope.form.address,file:e.$scope.QR_code};console.log("data=>",n),this.bindingCard(n)}},{key:"bindingCard",value:function(e){var n=this;this.$RS.bindingCard(e).then(function(e){n.$scope.form.bank_pwd="",200==e.code?(n.$scope.form={},n.Layer.toast(e.data,.3,function(){n.$state.go("tabs.my")})):n.Layer.toast(e.msg)})}}]),e}();n.default=u},309:function(e,n){e.exports='<iheader> <back></back> <h1 class=title>{{title}}</h1> </iheader> <content class=bindCard> <form class="radius5 fs14"> <input type=password style=position:absolute;top:-10000px> <div class="bank-card-form m-t10"> <div class="row input-group bg-form-group" ng-if="show_name && type == 2"> <div class=pd-l10>真实姓名</div> <div class=m-l10> <input class="bg-input-none placeholder-gray" ng-model=form.bank_name placeholder=请输入持卡人姓名> </div> </div> </div> <div class="bank-card-form m-t10" ng-if="type != 2"> <div class="row input-group bg-form-group underline-gray"> <div class=pd-l10>收款机构</div> <div class=m-l10> <span>{{type == 1? \'微信\': \'支付宝\'}}</span> </div> </div> <div class="row input-group bg-form-group underline-gray"> <div class=pd-l10>{{type == 1? \'微信\': \'支付宝\'}}账号</div> <div class=m-l10 ng-if="type == \'0\'"> <input class="bg-input-none placeholder-gray" placeholder=请输入支付宝账号 ng-model=form.zfb /> </div> <div class=m-l10 ng-if="type == 1"> <input class="bg-input-none placeholder-gray" placeholder=请输入微信账号 ng-model=form.wx /> </div> </div> <div class="row input-group bg-form-group"> <div class="pd-l10 col-25">收款二维码</div> <div class="m-l10 upload_QRCode"> <span class="light-gray fs14">点击上传二维码</span> <input type=file class="bg-input-none placeholder-gray" multiple=multiple accept=image/* file-up-load=uploadQRCode> <img id=QR_code_box ng-show=QR_code ng-src={{QR_code}}> <i class="iconfont fr m-r10" ng-hide=QR_code> &#xe620;</i> </div> </div> </div> <div class="bank-card-form m-t10" ng-if="type == 2"> <div class="row input-group bg-form-group underline-gray"> <div class=pd-l10>收款银行</div> <div class=m-l10> <input class="bg-input-none placeholder-gray" placeholder=请输入银行卡号 ng-model=form.bank_num /> </div> </div> <div class="row input-group bg-form-group underline-gray"> <div class="pd-l10 col-30">银行</div> <div class="text-right col-70" ng-click=showBankList()> <span class=m-r20>{{form.bank_id? bankList[form.bank_id].name:\'请选择银行\'}}</span> <i class="icon iconfont icon-arrow-right fs16 gray"></i> </div> </div> <div class="row input-group bg-form-group"> <div class=pd-l10>开户行</div> <div class=m-l10> <input class="bg-input-none placeholder-gray" placeholder=请输入开户银行地址 ng-model=form.address /> </div> </div> </div> <div class="bank-card-form m-t10"> <div class="row input-group bg-form-group" ng-if="isPhone && show_phone"> <div class=pd-l10>手机号码</div> <div class=m-l10> <input class="bg-input-none placeholder-gray" type="text bg-input-none" ng-model=form.phone placeholder=请输入您的手机号> </div> </div> </div> <div class="bank-card-form m-t10"> <div class="row input-group bg-form-group radius5"> <div class=pd-l10>资金密码</div> <div class=m-l10> <input type=password class="bg-input-none placeholder-gray" placeholder="{{isPwd?\'请验证资金密码\':\'请设置资金密码\'}}" ng-model=form.bank_pwd maxlength=6 /> </div> </div> </div> </form> <div class=bottom-btn> <button class="button button-big button-fill" ng-click=submit()> 确认</button> </div> </content> '},363:function(e,n,s){"use strict";n.__esModule=!0,n.default=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}},364:function(e,n,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var o=s(365),t=i(o);n.default=function(){function e(e,n){for(var s=0;s<n.length;s++){var i=n[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,t.default)(e,i.key,i)}}return function(n,s,i){return s&&e(n.prototype,s),i&&e(n,i),n}}()},365:function(e,n,s){e.exports={default:s(366),__esModule:!0}},366:function(e,n,s){s(367);var i=s(11).Object;e.exports=function(e,n,s){return i.defineProperty(e,n,s)}},367:function(e,n,s){var i=s(15);i(i.S+i.F*!s(21),"Object",{defineProperty:s(20).f})},426:function(e,n,s){e.exports={default:s(430),__esModule:!0}},430:function(e,n,s){s(121),s(65),e.exports=s(435)},435:function(e,n,s){var i=s(13),o=s(70);e.exports=s(11).getIterator=function(e){var n=o(e);if("function"!=typeof n)throw TypeError(e+" is not iterable!");return i(n.call(e))}}});